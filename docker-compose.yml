# version is obsolete in newer Docker Compose versions

services:
  game:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Docker Compose automatically reads .env file in same directory
        # These values are used at build time (NEXT_PUBLIC_* vars are embedded during npm run build)
        NEXT_PUBLIC_FRONTEND_URL: ${NEXT_PUBLIC_FRONTEND_URL:-http://localhost:3000}
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:3000}
    container_name: syniad-game-local
    ports:
      - "3000:8080"
    # Override ENTRYPOINT and CMD for local development - don't use Lambda Web Adapter
    entrypoint: []
    command: ["node", "server.js"]
    environment:
      # Runtime environment variables from root .env file
      NODE_ENV: ${NODE_ENV:-production}
      PORT: ${PORT:-8080}
      HOSTNAME: ${HOSTNAME:-0.0.0.0}
      NEXT_TELEMETRY_DISABLED: ${NEXT_TELEMETRY_DISABLED:-1}
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:3000}
      NEXT_PUBLIC_FRONTEND_URL: ${NEXT_PUBLIC_FRONTEND_URL:-http://localhost:3000}
      NEXTAUTH_URL: ${NEXTAUTH_URL:-http://localhost:3000}
      NEXT_PUBLIC_ASSET_PREFIX: ${NEXT_PUBLIC_ASSET_PREFIX:-}
      NEXT_PUBLIC_BASE_PATH: ${NEXT_PUBLIC_BASE_PATH:-}
      COGNITO_USER_POOL_ID: ${COGNITO_USER_POOL_ID}
      COGNITO_CLIENT_ID: ${COGNITO_CLIENT_ID}
      COGNITO_CLIENT_SECRET: ${COGNITO_CLIENT_SECRET:-}
      COGNITO_REGION: ${COGNITO_REGION}
      COGNITO_DOMAIN: ${COGNITO_DOMAIN}
      BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET}
      # AWS Configuration for DynamoDB
      AWS_REGION: ${AWS_REGION:-us-east-1}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      AWS_SESSION_TOKEN: ${AWS_SESSION_TOKEN:-}
      AWS_PROFILE: ${AWS_PROFILE:-}
      # DynamoDB Table Names
      GAMES_TABLE: ${GAMES_TABLE:-}
      PLAYER_GAMES_TABLE: ${PLAYER_GAMES_TABLE:-}
      SCENARIOS_TABLE: ${SCENARIOS_TABLE:-}
      # Set LOCAL_MODE=false to use real DynamoDB (default behavior)
      LOCAL_MODE: ${LOCAL_MODE:-false}
    restart: unless-stopped
